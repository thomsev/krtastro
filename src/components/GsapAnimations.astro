<script is:inline>
  const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

  if (!prefersReducedMotion) {
    const loadGsap = () =>
      new Promise((resolve, reject) => {
        if (window.gsap) {
          resolve(window.gsap);
          return;
        }
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js';
        script.async = true;
        script.onload = () => resolve(window.gsap);
        script.onerror = reject;
        document.head.appendChild(script);
      });

    loadGsap()
      .then((gsap) => {
        if (!gsap) return;
        const targets = Array.from(document.querySelectorAll('[data-animate]'));
        if (targets.length === 0) return;

        const observer = new IntersectionObserver(
          (entries, obs) => {
            entries.forEach((entry) => {
              if (!entry.isIntersecting) return;
              const element = entry.target;
              gsap.to(element, {
                opacity: 1,
                y: 0,
                duration: 0.6,
                ease: 'power2.out'
              });
              obs.unobserve(element);
            });
          },
          { threshold: 0.2 }
        );

        targets.forEach((element) => {
          gsap.set(element, { opacity: 0, y: 16 });
          observer.observe(element);
        });
      })
      .catch(() => {});
  }
</script>
